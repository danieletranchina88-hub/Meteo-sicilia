<!DOCTYPE html>
<html>
<head>
  <title>Sicilia MeteoHub - DARK RELIEF</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body { margin: 0; background: #050505; font-family: 'Segoe UI', Roboto, sans-serif; color: white; overflow: hidden; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; background: #050505; }

    /* UI stile tuo */
    #basemap-selector{
      position:absolute; top:20px; left:20px; z-index:1000;
      background: rgba(10,10,10,0.85); backdrop-filter: blur(8px);
      border-radius: 12px; padding: 6px; border: 1px solid rgba(255,255,255,0.15);
      display:flex; gap:6px;
    }
    .base-btn{
      background: rgba(255,255,255,0.05); color:#aaa; border:none;
      padding: 8px 16px; border-radius: 8px; cursor:pointer;
      font-size: 13px; font-weight: 700; transition: all .2s;
    }
    .base-btn:hover{ background: rgba(255,255,255,0.2); color:white; }
    .base-btn.active{
      background:#0088ff; color:white;
      box-shadow: 0 2px 10px rgba(0,136,255,0.4);
    }

    /* Rilievi: rendili più “presenti” */
    .hillshade-tiles {
      mix-blend-mode: overlay;           /* fa emergere le ombre senza “lavare” tutto */
      filter: contrast(1.35) brightness(0.85);
    }

    /* Se vuoi ancora più rilievo, aumenta contrast e/o opacity nel JS */
  </style>
</head>
<body>

  <div id="basemap-selector">
    <button class="base-btn active" onclick="setBaseMap('dark_relief')">DARK RILIEVI</button>
    <button class="base-btn" onclick="setBaseMap('sat')">SATELLITE</button>
  </div>

  <div id="map"></div>

  <script>
    let map;
    let darkBase, satBase, labels, hillshade;
    let currentBase = 'dark_relief';

    window.addEventListener('load', () => {
      map = L.map('map', { zoomControl: false }).setView([37.5, 14.2], 8);

      // Panes (ordine preciso)
      map.createPane('basePane');      map.getPane('basePane').style.zIndex = 200;
      map.createPane('hillPane');      map.getPane('hillPane').style.zIndex = 260;
      map.createPane('labelsPane');    map.getPane('labelsPane').style.zIndex = 600;

      // --- BASE DARK ---
      darkBase = L.tileLayer(
        'https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png',
        { pane: 'basePane', maxZoom: 19, opacity: 1.0, attribution: '©OpenStreetMap, ©Carto' }
      );

      // --- SATELLITE ---
      satBase = L.tileLayer(
        'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
        { pane: 'basePane', maxZoom: 19, opacity: 1.0, attribution: 'Tiles © Esri' }
      );

      // --- HILLSHADE (RILIEVI) ---
      // Esri World Hillshade (solo ombreggiatura)
      hillshade = L.tileLayer(
        'https://server.arcgisonline.com/ArcGIS/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}',
        {
          pane: 'hillPane',
          maxZoom: 19,
          opacity: 0.42,              // <--- aumenta a 0.50 se vuoi rilievi ancora più marcati
          className: 'hillshade-tiles',
          attribution: 'Hillshade © Esri'
        }
      );

      // --- LABELS SEMPRE SOPRA (su dark sono perfette; su satellite aiutano) ---
      labels = L.tileLayer(
        'https://{s}.basemaps.cartocdn.com/dark_only_labels/{z}/{x}/{y}{r}.png',
        { pane: 'labelsPane', maxZoom: 19, opacity: 1.0 }
      );

      // Default: dark + rilievi + labels
      darkBase.addTo(map);
      hillshade.addTo(map);
      labels.addTo(map);
    });

    window.setBaseMap = function(type) {
      document.querySelectorAll('.base-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');

      // rimuovi tutto
      map.removeLayer(darkBase);
      map.removeLayer(satBase);
      map.removeLayer(hillshade);

      if (type === 'dark_relief') {
        darkBase.addTo(map);
        hillshade.addTo(map);         // rilievi ON
      } else {
        satBase.addTo(map);
        // Se vuoi rilievi anche su satellite, scommenta:
        // hillshade.setOpacity(0.25);
        // hillshade.addTo(map);
      }

      currentBase = type;
      // labels restano sempre sopra
      if (!map.hasLayer(labels)) labels.addTo(map);
    }
  </script>

</body>
</html>
