name: Update Meteo Data

on:
  schedule:
    # Esegue ogni 6 ore (alle 00:00, 06:00, 12:00, 18:00 UTC)
    - cron: '0 0,6,12,18 * * *'
  workflow_dispatch: # Permette di avviarlo manualmente dal tab "Actions"

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
    # 1. Scarica il codice del repository
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2. Installa la libreria di sistema necessaria per leggere i file GRIB
    - name: Install system dependencies (eccodes)
      run: |
        sudo apt-get update
        sudo apt-get install -y libeccodes-dev

    # 3. Imposta Python
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 4. Installa le librerie Python necessarie
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests xarray numpy cfgrib

    # 5. Esegue lo script Python (il "cervello" che scarica i dati)
    - name: Run data processor
      run: python scripts/process_data.py

    # 6. Salva i nuovi dati nel repository (Commit & Push)
    - name: Commit and push changes
      run: |
        git config --global user.name "GitHub Action"
        git config --global user.email "action@github.com"
        git add data_weather/
        # Il comando commit fallisce se non ci sono modifiche, quindi usiamo "|| echo..." per non bloccare tutto
        git commit -m "Auto-update weather data" || echo "No changes to commit"
        git push
        
